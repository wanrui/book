# traffic server 超时参数说明
## 1. 相关参数列表
### 1.1 父相关参数
#### 1.1.1 vcache版本
```
##############################
# parent proxy configuration #
##############################
#是否开启父节点
CONFIG proxy.config.http.parent_proxy_routing_enable INT 0
#当父节点不可用时，重试父节点的时间
CONFIG proxy.config.http.parent_proxy.retry_time INT 300
# Parent fail threshold is the number of request that must
# fail within the retry window for the parent to be marked
# down
#父节点不可用的阈值为重试一定次数失败后即标记为失败
#父节点探测次数，失败则任务父节点不可用
CONFIG proxy.config.http.parent_proxy.fail_threshold INT 10
#在跳过父节点缓存或者是回复请求失败之前允许连接尝试的次数（依赖于bypass.config的go_direct选项）
CONFIG proxy.config.http.parent_proxy.total_connect_attempts INT 4
#当有多个父节点时，每个父节点允许的连接数
CONFIG proxy.config.http.parent_proxy.per_parent_connect_attempts INT 2
#父节点缓存的连接超时的超时时间
CONFIG proxy.config.http.parent_proxy.connect_attempts_timeout INT 30
#配置ts发送代理身份验证头信息到父缓存
CONFIG proxy.config.http.forward.proxy_auth_to_parent INT 0
```

#### 1.1.2 traffic server 6.1.1 官方版本
```
##############################################################################
# Parent proxy configuration, in addition to these settings also see parent.config. Docs:
#    https://docs.trafficserver.apache.org/records.config#parent-proxy-configuration
#    https://docs.trafficserver.apache.org/en/latest/reference/configuration/parent.config.en.html
##############################################################################
#是否开启父节点
CONFIG proxy.config.http.parent_proxy_routing_enable INT 0
#当父节点不可用时，重试父节点的时间
CONFIG proxy.config.http.parent_proxy.retry_time INT 300
#父节点缓存的连接超时的超时时间
CONFIG proxy.config.http.parent_proxy.connect_attempts_timeout INT 30
#配置ts发送代理身份验证头信息到父缓存
CONFIG proxy.config.http.forward.proxy_auth_to_parent INT 0
CONFIG proxy.config.http.uncacheable_requests_bypass_parent INT 1
```

## 1.2 连接相关参数
### 1.2.1  vcache版本
```
###################################
# HTTP connection timeouts (secs) #
###################################
# out: proxy -> origin server connection
# in : ua -> proxy connection
#指定事务结束后为保证后续进入请求而继续保持连接的时间
CONFIG proxy.config.http.keep_alive_no_activity_timeout_in INT 115
#指定事务结束后为保证后续出口请求而继续保持连接的时间
CONFIG proxy.config.http.keep_alive_no_activity_timeout_out INT 120
#指定如果发生网络拥塞时（入），ts服务器多长时间与客户端断开连接
CONFIG proxy.config.http.transaction_no_activity_timeout_in INT 30
#知道如果发生网络拥塞时（出），ts服务器多长时间后与客户端断开连接
CONFIG proxy.config.http.transaction_no_activity_timeout_out INT 30
#和客户端保持连接的最长时间（入）
CONFIG proxy.config.http.transaction_active_timeout_in INT 900
#和客户端保持连接的最长时间（出）
CONFIG proxy.config.http.transaction_active_timeout_out INT 0
#关闭没有活动的连接的超时时间
CONFIG proxy.config.http.accept_no_activity_timeout INT 120
#指定预缓存服务器连接多久后断开与源服务器的连接
CONFIG proxy.config.http.background_fill_active_timeout INT 60
#?总文件大小的比例已转移时，客户端中止在该代表继续从原始服务器获取的文件，把它转换成高速缓存
CONFIG proxy.config.http.background_fill_completed_threshold FLOAT 0.5
```

### 1.2.2  traffic server 6.1.1 官方版本
```
##############################################################################
# HTTP connection timeouts (secs). Docs:
#    https://docs.trafficserver.apache.org/records.config#http-connection-timeouts
##############################################################################
CONFIG proxy.config.http.keep_alive_no_activity_timeout_in INT 115
CONFIG proxy.config.http.keep_alive_no_activity_timeout_out INT 120
CONFIG proxy.config.http.transaction_no_activity_timeout_in INT 30
CONFIG proxy.config.http.transaction_no_activity_timeout_out INT 30
CONFIG proxy.config.http.transaction_active_timeout_in INT 900
CONFIG proxy.config.http.transaction_active_timeout_out INT 0
CONFIG proxy.config.http.accept_no_activity_timeout INT 120
CONFIG proxy.config.net.default_inactivity_timeout INT 86400
##############################################################################
```


## 1.3 源站端相关参数
### 1.3.1  vcache版本
```
   ##################################
   # origin server connect attempts #
   ##################################
   
#当源服务器没有响应时，ts最大重试次数
CONFIG proxy.config.http.connect_attempts_max_retries INT 6
#当源服务器不可用时，ts最大重试次数
CONFIG proxy.config.http.connect_attempts_max_retries_dead_server INT 3
#如果该服务器DNS有做轮询，则在轮询条目标记为down之前允许尝试连接失败的最大值
CONFIG proxy.config.http.connect_attempts_rr_retries INT 3
#源服务器连接的超时时间
CONFIG proxy.config.http.connect_attempts_timeout INT 30
#POST/PUT请求时，源服务器的超时值
CONFIG proxy.config.http.post_connect_attempts_timeout INT 1800
#Server记录服务器down的时间，在该段时间内认为服务器down(以秒记)
CONFIG proxy.config.http.down_server.cache_time INT 300
#在一个客户端因为源服务器响应太慢而放弃请求之后到TS标记该服务器不可达之间的秒数
CONFIG proxy.config.http.down_server.abort_threshold INT 10
```

### 1.3.2 traffic server 6.1.1 官方版本
```
##############################################################################
# Origin server connect attempts. Docs:
#    https://docs.trafficserver.apache.org/records.config#origin-server-connect-attempts
##############################################################################
CONFIG proxy.config.http.connect_attempts_max_retries INT 3
CONFIG proxy.config.http.connect_attempts_max_retries_dead_server INT 1
CONFIG proxy.config.http.connect_attempts_rr_retries INT 3
CONFIG proxy.config.http.connect_attempts_timeout INT 30
CONFIG proxy.config.http.post_connect_attempts_timeout INT 1800
CONFIG proxy.config.http.down_server.cache_time INT 60
CONFIG proxy.config.http.down_server.abort_threshold INT 10
```
## 2. 功能说明
1. at most two netvc(connections) on a given transaction(txn)
2. client side conncetion (in);server side conncection(out)
3. separate inactivity,active timers for each netvc at any given state
4. active_timer_bg_fill on a premature client abort(during download)
5. connect_timer runs until the first byte from origin(ts-242)
6. "accpect " indicates successful ssl handshake for  tls connctions

```
inactivity_timer_default-->CONFIG proxy.config.net.default_inactivity_timeout INT 86400（6.1.1 版本才有的配置）
inactivity_timer_accept(in)-->CONFIG proxy.config.http.accept_no_activity_timeout INT 120
inactivity_timer_txn(in)-->CONFIG proxy.config.http.transaction_no_activity_timeout_in INT 30
activity_timer_txn(in)-->CONFIG proxy.config.http.transaction_active_timeout_in INT 900
inactivity_timer_ka(in)--> CONFIG proxy.config.http.keep_alive_no_activity_timeout_in INT 115
connect_timer-->CONFIG proxy.config.http.connect_attempts_timeout INT 30
inactivity_timer_txn(out)-->CONFIG proxy.config.http.transaction_no_activity_timeout_out INT 30
activicty_timer_txn(out)-->CONFIG proxy.config.http.transaction_active_timeout_out INT 0
activity_time_bg_fill(out)-->CONFIG proxy.config.http.background_fill_active_timeout INT 60
inactiviy_timer_ka(out)-->CONFIG proxy.config.http.keep_alive_no_activity_timeout_out INT 120
```



## 3. 功能原理



## 4. 调整策略
